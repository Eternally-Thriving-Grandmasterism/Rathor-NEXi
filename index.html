<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Rathor — Mercy Strikes First</title>
  <meta name="description" content="Sovereign offline AGI lattice" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Critical preloads -->
  <link rel="preload" href="/assets/entry/main-[hash].js" as="script" fetchpriority="high" />
  <link rel="preload" href="/assets/vendor-[hash].js" as="script" fetchpriority="high" />
  <link rel="preload" href="/manifest.json" as="fetch" crossorigin="anonymous" fetchpriority="high" />
  <link rel="modulepreload" href="/src/main.tsx" />

  <!-- Preload heavy ML deps early -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.5/holistic.js" as="script" fetchpriority="high" />
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl" as="script" fetchpriority="high" />

  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body,html{height:100%;overflow:hidden;background:#000;color:#00ff88;font-family:'Courier New',monospace}
    #root{height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2rem}
    .loading-container{text-align:center;position:relative;z-index:10}
    .thunder-text{font-size:1.8rem;text-shadow:0 0 10px #00ff88;animation:pulse 3s infinite}
    .progress-bar{width:300px;height:6px;background:#111;border-radius:3px;overflow:hidden;margin:1.5rem auto}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#00ff88,#00aaff);transition:width 0.4s ease-out}
    .skeleton{background:#111;border-radius:8px;animation:shimmer 2s infinite}
    @keyframes pulse{0%,100%{opacity:.7}50%{opacity:1}}
    @keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
  </style>
</head>
<body>
  <div id="root">
    <div class="loading-container">
      <div class="thunder-text">Thunder eternal surges through the lattice...</div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="skeleton" style="width:280px;height:120px;"></div>
      <div class="skeleton" style="width:240px;height:80px;margin-top:1rem;"></div>
      <p id="debug-msg" style="margin-top:2rem;color:#ff8800;font-size:1rem;">Loading lattice core...</p>
    </div>
  </div>

  <noscript>
    <div style="color:#ff4444;text-align:center;padding:2rem;">
      <h1>Mercy requires JavaScript to thrive</h1>
      <p>Enable JS to enter the lattice. Thriving continues offline when enabled.</p>
    </div>
  </noscript>

  <script>
    const progressFill = document.getElementById('progressFill');
    const debugMsg = document.getElementById('debug-msg');
    let progress = 0;

    const interval = setInterval(() => {
      progress += Math.random() * 25 + 10;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        debugMsg.textContent = "Finalizing lattice awakening...";
      } else {
        debugMsg.textContent = `Loading: ${Math.floor(progress)}%`;
      }
      progressFill.style.width = progress + '%';
    }, 120);

    // Debug helper – log when main chunk arrives
    window.addEventListener('vite:preloadError', (e) => {
      console.error('[Vite Preload Error]', e);
      debugMsg.textContent = 'Chunk loading error – check console';
      debugMsg.style.color = '#ff4444';
    });
  </script>

  <script type="module" src="/src/main.tsx"></script>
</body>
</html>
