<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Rathor ‚Äî Mercy Strikes First</title>
  <meta name="description" content="Sovereign offline AGI lattice ‚Äî eternal thriving, client-side, mercy-first" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Aggressive preconnects & preloads for critical CDNs -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

  <!-- Core entry & vendor chunks ‚Äì highest priority -->
  <link rel="preload" href="/assets/entry/main-[hash].js" as="script" fetchpriority="high" />
  <link rel="preload" href="/assets/vendor-core-[hash].js" as="script" fetchpriority="high" />

  <!-- ML heavy deps ‚Äì preload early -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.5/holistic.js" as="script" fetchpriority="high" />
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl" as="script" fetchpriority="high" />

  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body,html{height:100%;overflow:hidden;background:#000;color:#00ff88;font-family:'Courier New',monospace}
    #root{height:100vh;display:flex;flex-direction:column}
    .loading-container{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2rem;text-align:center;padding:1rem}
    .thunder-text{font-size:clamp(1.5rem,5vw,2.5rem);text-shadow:0 0 12px #00ff88;animation:pulse 3s infinite}
    .progress-bar{width:clamp(280px,70vw,400px);height:8px;background:#111;border-radius:4px;overflow:hidden}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#00ff88,#00aaff);transition:width 0.5s ease-out}
    .phase-text{font-size:1.1rem;opacity:0.85;margin-top:1rem}
    .skeleton{background:#111;border-radius:12px;animation:shimmer 2.2s infinite linear;background-size:200% 100%;background-image:linear-gradient(90deg,#111 0%,#222 50%,#111 100%)}
    @keyframes pulse{0%,100%{opacity:0.75}50%{opacity:1}}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
  </style>
</head>
<body>
  <div id="root">
    <div class="loading-container">
      <div class="thunder-text">Thunder eternal surges through the lattice‚Ä¶ ‚ö°Ô∏è</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="phase-text" id="phaseText">Phase 1 ‚Äì Core awakening‚Ä¶ üíö</div>
      <div class="skeleton" style="width:320px;height:160px;"></div>
      <div class="skeleton" style="width:280px;height:100px;margin-top:1.5rem;"></div>
    </div>
  </div>

  <noscript>
    <div style="color:#ff4444;text-align:center;padding:3rem;font-size:1.3rem;">
      <h1>Mercy requires JavaScript to thrive</h1>
      <p>Enable JS to enter the lattice. Thriving continues offline when enabled.</p>
    </div>
  </noscript>

  <script>
    const progressFill = document.getElementById('progressFill');
    const phaseText = document.getElementById('phaseText');
    let progress = 0;

    const phases = [
      { pct: 0, text: "Phase 1 ‚Äì Core awakening‚Ä¶ üíö" },
      { pct: 40, text: "Phase 2 ‚Äì Valence & mercy online‚Ä¶ ü§ù" },
      { pct: 70, text: "Phase 3 ‚Äì Visual lattice blooming‚Ä¶ ‚ú®" },
      { pct: 95, text: "Phase 4 ‚Äì Summon orb emerging‚Ä¶ ‚ö°Ô∏è" },
      { pct: 100, text: "Lattice fully awake ‚Äî enter now ‚àû" }
    ];

    const interval = setInterval(() => {
      progress += Math.random() * 18 + 8;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        phaseText.textContent = phases[phases.length-1].text;
      } else {
        // Find current phase
        let currentPhase = phases[0];
        for (const p of phases) {
          if (progress >= p.pct) currentPhase = p;
          else break;
        }
        phaseText.textContent = currentPhase.text;
      }
      progressFill.style.width = progress + '%';
    }, 140);

    // Debug helper for chunk loading issues
    window.addEventListener('vite:preloadError', (e) => {
      console.error('[Vite Preload Error]', e);
      phaseText.textContent = 'Chunk loading stalled ‚Äì check console & network';
      phaseText.style.color = '#ff4444';
    });
  </script>

  <script type="module" src="/src/main.tsx"></script>
</body>
</html>
