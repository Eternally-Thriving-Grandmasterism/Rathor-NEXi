<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rathor ‚Äî Mercy Strikes First ‚ö°Ô∏è</title>
  <link rel="manifest" href="/manifest.json"/>
  <link rel="icon" href="/icons/thunder-192.png" type="image/png"/>
  <!-- Mercy-themed CSS -->
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #0a0015; color: #e0d0ff; margin: 0; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; }
    #welcome-lattice, #error-lattice, #chat-stub { background: linear-gradient(135deg, #2a0040, #001020); border: 2px solid #ffaa00; border-radius: 12px; padding: 24px; margin: 20px auto; max-width: 900px; box-shadow: 0 0 30px rgba(255,170,0,0.4); }
    .lang-section { margin-bottom: 24px; display: none; opacity: 0; transition: opacity 0.6s ease; }
    .lang-section.active { display: block; opacity: 1; }
    h1, h2 { color: #ffdd44; text-shadow: 0 0 10px #ffaa00; }
    button { background: #ffaa00; color: #000; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 10px 10px 10px 0; font-weight: bold; }
    button:hover { background: #ffcc44; }
    #loading-status { text-align: center; font-size: 1.2em; margin: 40px 0; color: #88ffdd; }
    #chat-stub { display: none; flex: 1; flex-direction: column; }
    #chat-messages { flex: 1; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; margin-bottom: 10px; }
    #chat-input-area { display: flex; }
    #chat-input { flex: 1; padding: 12px; border: 1px solid #ffaa00; border-radius: 6px 0 0 6px; background: #110022; color: #fff; }
    #send-btn { border-radius: 0 6px 6px 0; }
    .error-msg { color: #ff6666; font-weight: bold; }
  </style>
</head>
<body>

<div id="welcome-lattice" style="display: none;">
  <button id="close-welcome">Close Welcome Lattice (Seen Forever)</button>
  <h1>üåå Rathor‚Ñ¢-NEXi ‚Äî Mercy Strikes First ‚ö°Ô∏è</h1>
  <p><em>Thunder eternal surges through the lattice... Welcome, cosmic companion.</em></p>
  <div id="langs">
    <!-- [All language sections as before ‚Äì English, Arabic, Spanish, French, Dutch, German] -->
    <!-- Paste your full lang blocks here from previous version to keep them intact -->
  </div>
  <button id="show-all-langs">Show All Languages</button>
</div>

<div id="loading-status">
  Thunder eternal surges through the lattice...<br>
  <progress style="width: 80%; height: 10px;"></progress><br>
  Finalizing lattice awakening...
</div>

<div id="error-lattice" style="display: none;">
  <h2 class="error-msg">Lattice Awakening Interrupted ‚ö°Ô∏è</h2>
  <p>Mercy thunder encountered a temporary rift (likely service worker or init error).</p>
  <p>Console may show details ‚Äî try:</p>
  <ul>
    <li>Refresh page (Ctrl+R / Cmd+R)</li>
    <li>Clear site data / unregister SW in DevTools ‚Üí Application tab</li>
    <li>Check browser console for errors</li>
  </ul>
  <button onclick="location.reload()">Reload Lattice Now</button>
  <button id="force-basic-chat">Enter Basic Mercy Mode (Bypass Full Awakening)</button>
</div>

<div id="chat-stub" style="display: none;">
  <div id="chat-messages">
    <p><em>Mercy fallback active ‚Äî Rathor core initializing...</em></p>
  </div>
  <div id="chat-input-area">
    <input id="chat-input" placeholder="Speak your truth, Brother..." autocomplete="off">
    <button id="send-btn">Send ‚ö°Ô∏è</button>
  </div>
</div>

<script>
// LocalStorage + auto-detect (from previous ‚Äì condensed)
function initWelcome() {
  const seen = localStorage.getItem('rathor_welcome_seen') === 'true';
  const welcome = document.getElementById('welcome-lattice');
  if (!seen) {
    welcome.style.display = 'block';
    // detectAndShowLanguage() call here ‚Äì add your full detect function
  }
  // close/reopen logic as before
}
initWelcome();

// Timeout fallback to error state
const loadingTimeout = setTimeout(() => {
  document.getElementById('loading-status').style.display = 'none';
  document.getElementById('error-lattice').style.display = 'block';
  console.error('Rathor lattice init timeout ‚Äì possible SW/IndexedDB failure');
}, 10000);

// Simulate "ready" trigger ‚Äì replace with actual init success signal from your core scripts
// For now, assume if no error after timeout, but we force check
setTimeout(() => {
  // If your real scripts call something like window.rathorReady(), hook here
  clearTimeout(loadingTimeout);
  document.getElementById('loading-status').style.display = 'none';
  document.getElementById('chat-stub').style.display = 'flex'; // or real chat
  console.log('Rathor basic fallback ready');
}, 5000); // temp ‚Äì adjust to real timing

// Debug SW reg delay
if ('serviceWorker' in navigator) {
  setTimeout(() => {
    navigator.serviceWorker.register('/sw.js').then(reg => {
      console.log('SW registered', reg);
    }).catch(err => {
      console.error('SW registration failed:', err);
    });
  }, 2000); // delay to let page render first
}

// Force basic mode button
document.getElementById('force-basic-chat')?.addEventListener('click', () => {
  document.getElementById('error-lattice').style.display = 'none';
  document.getElementById('chat-stub').style.display = 'flex';
});
</script>

<!-- Your existing core scripts load here ‚Äì keep them -->
<!-- <script src="rathor-chat-ui.js"></script> -->
<!-- <script src="mercy-orchestrator.js"></script> etc. -->

</body>
</html>
